1. NORMALIZATION

Users
ID	NAME*	MIDDLE_NAME	LAST_NAME*	SECOND_LAST_NAME	DOCUMENT_ID* FORMALITY	NATIONALITY_ID*	BIRTHDATE(YYYYmmDD)*	BIRTH_COUNTRY_ID* CONSTRAINT COLOMBIA	BIRTH_PROVIDENCE_ID*	BIRTH_CITY_ID* POSTAL_CODE ADDRESS* ADDRESS_DETAIL	EMAIL*	PHONE_COUNTRY_PREFIX*	CELLPHONE* PASSWORD* PREFERENCE_ID	PROMO_CODE_ID DEPOSIT_LIMIT_ID SOFT_DELETION

Preferences
ID USER_ID ACCEPTED_TERMS*  ACCEPTED_BULLETIN   SPORT_BETS_EMAILS SMS BROWSER_NOTIFICATIONS BET_CHART_NOTIFICATION SOFT_DELETION

Countries
ID NAME SOFT_DELETION

Providences
ID NAME SOFT_DELETION

Cities
ID NAME SOFT_DELETION

Documents
ID DOCUMENT_TYPE* (CONSTRAINT CEDULA) EXPEDITION_COUNTRY_ID* EXPEDITION_DATE(YYYYmmDD)* SOFT_DELETION

Deposit_Limits
ID DAILY_DEPOSIT_LIMIT DAILY_DEPOSIT_TIMESTAMP DAILY_BET_LIMIT DAILY_BET_TIMESTAMP WEEKLY_DEPOSIT_LIMIT	WEEKLY_DEPOSIT_TIMESTAMP	WEEKLY_BET_LIMIT	WEEKLY_BET_TIMESTAMP	MONTHLY_DEPOSIT_LIMIT	MONTHLY_DEPOSIT_TIMESTAMP MONTHLY_BET_LIMIT	MONTHLY_BET_TIMESTAMP SOFT_DELETION

Promo_Codes
ID PROMO_CODE START_DATE END_DATE STATUS SOFT_DELETION

Users_Bets
ID USER_ID BET_DETAIL_ID SOFT_DELETION

Bets
ID BET_STATE BET_TYPE MATCH_ID BET_MULTIPLIER_1 BET_MULTIPLIER_2 BET_MULTIPLIER_3 SOFT_DELETION

Matches
ID LOCAL VISITOR DATE TIME STATUS SOFT_DELETION

Bets_Details
ID BET_ID MATCH_ID BET_OPTION BET_MULTIPLIER BET_AMOUNT STATUS SOFT_DELETION

Deposits
ID DEPOSIT_AMOUNT PAYMENT_METHOD_ID DEPOSIT_DESCRIPTION STATUS TIMESTAMP SOFT_DELETION

Payment_Methods
ID PAYMENT_NAME PAYMENT_LOWER_LIMIT PAYMENT_UPPER_LIMIT SOFT_DELETION

Users_Deposits
ID USER_ID DEPOSIT_ID SOFT_DELETION

Withdrawals
ID WITHDRAWAL_AMOUNT USER_BANK_ACCOUNT_ID WITHDRAWAL_REQUIREMENTS	USER_SECURITY_DOCUMENT_ID  TIMESTAMP STATUS SOFT_DELETION

User_Bank_Accounts
ID USER_ID BANK_ID ACCOUNT_NUMBER

Banks
ID BANK_NAME SOFT_DELETION

Users_Security_Documents
ID USER_ID SECURITY_DOCUMENT_ID SOFT_DELETION

Security_Documents
ID NAME SECURITY_DOCUMENT_TYPE FILE_SIZE FILE_EXTENSION FILE_URL SOFT_DELETION

Bet_Auditing_Table
ID TIMESTAMP TABLE RECORD_ID ACTION USER IP

2. TABLESPACES


CREATE SMALLFILE TABLESPACE BET_ITM
    DATAFILE 'C:\BET_ITM\BET_ITM1.DBF' SIZE 512M
    DATAFILE 'C:\BET_ITM\BET_ITM2.DBF' SIZE 512M
    EXTENT MANAGEMENT LOCAL AUTOALLOCATE;

CREATE BIGFILE TABLESPACE BET_AUDITING
    DATAFILE 'C:\BET_ITM\lmtbsb01' SIZE 2G
    EXTENT MANAGEMENT LOCAL AUTOALLOCATE;

ALTER SYSTEM SET UNDO RENAME TO UNDO_BET_ITM
    DATAFILE 'C:\BET_ITM\BET_ITM_UNDO.DBF' SIZE 500M;


3. PROFILES

CREATE  PROFILE developer LIMIT
    SESSIONS_PER_USER 1
    CONNECT_TIME 60
    IDLE_TIME 30
    FAILED_LOGIN_ATTEMPS 5
    PASSWORD_LIFE_TIME 90;

CREATE  PROFILE web_application LIMIT
    SESSIONS_PER_USER 5
    CONNECT_TIME UNLIMITED
    IDLE_TIME UNLIMITED
    FAILED_LOGIN_ATTEMPS 2
    PASSWORD_LIFE_TIME 30;

 CREATE  PROFILE dba_admin LIMIT
    SESSIONS_PER_USER 1
    CONNECT_TIME 30
    IDLE_TIME UNLIMITED
    FAILED_LOGIN_ATTEMPS 2
    PASSWORD_LIFE_TIME 30;

CREATE  PROFILE analyst LIMIT
    SESSIONS_PER_USER 1
    CONNECT_TIME 30
    IDLE_TIME 5
    FAILED_LOGIN_ATTEMPS 3
    PASSWORD_LIFE_TIME 30
    PASSWORD_GRACE_TIME 3;

CREATE  PROFILE support_iii LIMIT
    SESSIONS_PER_USER 1
    CONNECT_TIME 240
    IDLE_TIME 5
    FAILED_LOGIN_ATTEMPS 3
    PASSWORD_LIFE_TIME 20
    PASSWORD_GRACE_TIME 5;

CREATE  PROFILE reporter LIMIT
    SESSIONS_PER_USER 1
    CONNECT_TIME 90
    IDLE_TIME 15
    FAILED_LOGIN_ATTEMPS 4
    PASSWORD_LIFE_TIME UNLIMITED
    PASSWORD_GRACE_TIME 5;

CREATE  PROFILE auditor LIMIT
    SESSIONS_PER_USER 1
    CONNECT_TIME 90
    IDLE_TIME 15
    FAILED_LOGIN_ATTEMPS 4
    PASSWORD_LIFE_TIME UNLIMITED
    PASSWORD_GRACE_TIME 5;

4. ROLES AND PRIVILEGES

    I. The PUBLIC role is a default role that every account has when it is created, it has no privileges but it has grants to specific java objects. 
    II. The DBA_SYS_PRIVS retrieves information about user privileges related to the system. The DBA_TAB_PRIVS retrieves information about user privileges to the tables. The DBA_ROLE_PRIVS retrieves information about user privileges to roles modifications.
    III. Categories privileges:
        - SYSTEM Privileges, the right or hability to perform an action on any object of a particular type (tables, views, indexes, sequences, etc), only a user with ADMIN privilege can grant or revoke system privileges.
        - OBJECT Privileges, the right or hability to perform a particular action on an object or access another user's object (tables, views, indexes, sequences, etc). An object owner has all object privileges for that object, and those privileges can't be revoked. The owner can grant object privileges to other database users. A user with ADMIN privilege can grant and revoke object privileges from users who do not own the objects on which the privileges are granted.
        - PRIVILEGE Hierarchy, some privileges confer other privileges, ex. ADMIN privilege confers all other privileges. CREATE ANY TABLE system privilege confers the CREATE TABLE object privilege.

5. USERS

GRANT CREATE SESSION TO developer, web_application, dba_admin, analyst, support_iii, reporter, auditor;

CREATE USER developer_user
    IDENTIFIED BY developer
    PROFILE developer
    DEFAULT TABLESPACE BET_ITM;

CREATE USER web_user
    IDENTIFIED BY webpage
    PROFILE web_application
    DEFAULT TABLESPACE BET_ITM;

CREATE USER dba_user
    IDENTIFIED BY dba
    PROFILE dba_admin
    DEFAULT TABLESPACE BET_ITM;

CREATE USER analyst_user
    IDENTIFIED BY analyst
    PROFILE analyst
    DEFAULT TABLESPACE BET_ITM;

CREATE USER support_user
    IDENTIFIED BY support
    PROFILE support_iii
    DEFAULT TABLESPACE BET_ITM;

CREATE USER reporter_user
    IDENTIFIED BY reporter
    PROFILE reporter
    DEFAULT TABLESPACE BET_ITM;

CREATE USER auditor_user
    IDENTIFIED BY auditor
    PROFILE auditor
    DEFAULT TABLESPACE BET_ITM;

CREATE USER backup_dba
    IDENTIFIED BY dbabackup
    PROFILE dba_admin
    DEFAULT TABLESPACE BET_ITM;

CREATE USER backup_developer
    IDENTIFIED BY devbackup
    PROFILE developer
    DEFAULT TABLESPACE BET_ITM;

CREATE USER backup_web
    IDENTIFIED BY webbackup
    PROFILE web_application
    DEFAULT TABLESPACE BET_ITM;



TABLES

alter session set "_ORACLE_SCRIPT"=true;

CREATE TABLE USERS (	
ID NUMBER GENERATED ALWAYS AS IDENTITY,
USER_NAME varchar2(255),
MIDDLE_NAME varchar2(255),	
LAST_NAME varchar2(255),	
SECOND_LAST_NAME varchar2(255),	
DOCUMENT_ID number(22),PRIMARY KEY,	
FORMALITY varchar2(255), CONSTRAINT 'MR', 'MSS',/*REVISAR*/
NATIONALITY_ID varchar2(255),	/*REVISAR*/
BIRTHDATE(YYYYmmDD)* SYSDATE,'YYYYMMDD',	
BIRTH_COUNTRY*  varchar2(255),	CONSTRAINT 'COLOMBIA'/*REVISAR*/
BIRTH_PROVIDENCE*  varchar2(255),	
BIRTH_CITY*  varchar2(255),	
POSTAL_CODE ADDRESS*  varchar2(255),	
ADDRESS_DETAIL  varchar2(255),	
EMAIL*  varchar2(255),	
PHONE_COUNTRY_PREFIX*V	
CELLPHONE*  varchar2(255),	
USER_PASSWORD*  varchar2(255),	
PREFERENCE_ID varchar2(2),
PROMO_CODE_ID varchar2(2),
DEPOSIT_LIMIT_ID varchar2(2),
SOFT_DELETION CONSTRAINT DELETIONS CHECK (SOFT_DELETION IN ('DELETED' 'ENABLE'))
);

CREATE TABLE DOCUMENT (
ID NUMBER GENERATED ALWAYS AS IDENTITY,	PRIMARY KEY,
DOCUMENT_TYPE* (CONSTRAINT CEDULA) varchar2(100),
EXPEDITION_CITYY_ID* varchar2(100),
EXPEDITION_DATE(YYYYmmDD)* varchar2(255),
SOFT_DELETION CONSTRAINT DELETIONS CHECK (SOFT_DELETION IN ('DELETED' 'ENABLE'))
);

CREATE TABLE COUNTRIES (
ID NUMBER GENERATED ALWAYS AS IDENTITY,	PRIMARY KEY,
NAME varchar2(255),
PROVIDENCE_ID
CITY_ID NUMBER,
NATIONALITY NUMBER,
SOFT_DELETION CONSTRAINT DELETIONS CHECK (SOFT_DELETION IN ('DELETED' 'ENABLE'))
);

CREATE TABLE PROVIDENCE (
ID NUMBER GENERATED ALWAYS AS IDENTITY,	PRIMARY KEY,
NAME varchar2(100),
CITY_ID NUMBER,
NATIONALITY NUMBER,
SOFT_DELETION CONSTRAINT DELETIONS CHECK (SOFT_DELETION IN ('DELETED' 'ENABLE'))
);

CREATE TABLE CITIES
(
ID NUMBER (5) GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
NAME varchar2(50)
SOFT_DELETION CONSTRAINT DELETIONS CHECK (SOFT_DELETION IN ('DELETED' 'ENABLE'))
);

CREATE TABLE PREFERENCES(
ID NUMBER GENERATED ALWAYS AS IDENTITY,
USER_ID NUMBER
ACCEPTED_TERMS* varchar2(2),
ACCEPTED_BULLETIN varchar2(2),
SPORT_BETS_EMAILS varchar2(2),
SMS varchar2(2),
BROWSER_NOTIFICATIONS varchar2(2),
BET_CHART_NOTIFICATION varchar2(2),
SOFT_DELETION CONSTRAINT DELETIONS CHECK (SOFT_DELETION IN ('DELETED' 'ENABLE'))
);




CREATE TABLE Users_Bets(
ID NUMBER GENERATED ALWAYS AS IDENTITY, PRIMARY KEY,
USER_ID varchar2(255),
BET_DETAIL_ID varchar2(255),
SOFT_DELETION CONSTRAINT DELETIONS CHECK (SOFT_DELETION IN ('DELETED' 'ENABLE'))
);



CREATE TABLE BETS(
ID NUMBER GENERATED ALWAYS AS IDENTITY, PRIMARY KEY,
BET_STATE varchar2(2),
BET_TYPE varchar2(2),
MATCH_ID NUMBER NUMBER,
BET_MULTIPLIER_1 varchar2(10),
BET_MULTIPLIER_2 varchar2(10),
BET_MULTIPLIER_3 varchar2(10),
SOFT_DELETION CONSTRAINT DELETIONS CHECK (SOFT_DELETION IN ('DELETED' 'ENABLE'))
);

CREATE TABLE MATCHES(
ID NUMBER GENERATED ALWAYS AS IDENTITY, PRIMARY KEY,
LOCAL  varchar2(255),
VISITOR varchar2(255),
DATE TIMESTAMP WITH TIME ZONE,
TIME TIMESTAMP,
STATUS varchar2(255),
SOFT_DELETION CONSTRAINT DELETIONS CHECK (SOFT_DELETION IN ('DELETED' 'ENABLE'))
),


CREATE TABLE USERS_DEPOSITS(
ID NUMBER NOT NULL GENERATED ALWAYS AS IDENTITY, PRIMARY KEY,
USER_ID NUMBER,
DEPOSIT_ID NUMBER,
SOFT_DELETION CONSTRAINT DELETIONS CHECK (SOFT_DELETION IN ('DELETED','ENABLE'))
),

CREATE TABLE SECURITY_DOCUMENTS(
ID NUMBER GENERATED ALWAYS AS IDENTITY, PRIMARY KEY,
SECURITY_NAME varchar2(50),
SECURITY_DOCUMENT_TYPE varchar2(50),
FILE_SIZE varchar2(50),
FILE_EXTENSION varchar2(50),
FILE_URL varchar2(50),
SOFT_DELETION CONSTRAINT DELETIONS CHECK (SOFT_DELETION IN ('DELETED' 'ENABLE'))
);

CREATE TABLE DEPOSITS(
ID NUMBER GENERATED ALWAYS AS IDENTITY, PRIMARY KEY,
DEPOSIT_AMOUNT varchar2(255),
PAYMENT_METHOD_ID NUMBER,
DEPOSIT_DESCRIPTION varchar2(255),
PAYMENT_METODS_ID NUMBER,
STATUS CONSTRAINT DEPOSIT_STATE_STATE CHECK (STATUS IN ('PENDIENTE' 'EN PROCESO', 'RECHAZADA', 'EXITOSO'))
TIMESTAMP SYSDATE,'YYYYMMDD',
SOFT_DELETION CONSTRAINT DELETIONS CHECK (SOFT_DELETION IN ('DELETED','ENABLE'))
);

CREATE TABLE PAYMENT_METHODS
ID NUMBER GENERATED ALWAYS AS IDENTITY, PRIMARY KEY,
PAYMENT_NAME varchar2(50),
PAYMENT_RESTRICTION_ID NUMBER,
SOFT_DELETION CONSTRAINT DELETIONS CHECK (SOFT_DELETION IN ('DELETED' 'ENABLE'))
);

CREATE TABLE PAYMENTS RESTRICTIONS(
ID NUMBER GENERATED ALWAYS AS IDENTITY, PRIMARY KEY,
PAYMENT_LOWER_LIMIT
PAYMENT_UPPER_LIMIT
SOFT_DELETION CONSTRAINT DELETIONS CHECK (SOFT_DELETION IN ('DELETED' 'ENABLE'))
);


CREATE TABLE BANKS(
ID NUMBER GENERATED ALWAYS AS IDENTITY, PRIMARY KEY,
BANK_NAME varchar2(50),
SOFT_DELETION CONSTRAINT DELETIONS CHECK (SOFT_DELETION IN ('DELETED' 'ENABLE'))
);

CREATE TABLE USER_SECURITY_DOCUMENTS(
ID NUMBER GENERATED ALWAYS AS IDENTITY, PRIMARY KEY,
USER_ID NUMBER,
SECURITY_DOCUMENT_ID NUMBER,
SOFT_DELETION CONSTRAINT DELETIONS CHECK (SOFT_DELETION IN ('DELETED' 'ENABLE'))
);

CREATE TABLE PROMO_CODES(
ID NUMBER GENERATED ALWAYS AS IDENTITY, PRIMARY KEY,
START_DATE DATE,
END_DATE DATE,
STATUS CONSTRAINT CODE_STATE CHECK (STATUS IN ('PENDIENTE' 'EN PROCESO', 'RECHAZADA', 'EXITOSO'))
SOFT_DELETION CONSTRAINT DELETIONS CHECK (SOFT_DELETION IN ('DELETED' 'ENABLE'))
);

CREATE TABLE BETS_DETAILS(
ID NUMBER NOT NULL GENERATED ALWAYS AS IDENTITY, PRIMARY KEY,
BET_ID NUMBER,
MATCH_ID NUMBER,
BET_OPTION  varchar2(255),
BET_MULTIPLIER varchar2(255),
BET_AMOUNT varchar2(255),
STATUS CONSTRAINT BET_DETAIL_STATE 
CHECK (STATUS IN ('ABIERTA', 'GANADA', 'PERDIDA', 'VENDIDA','CANCELADA', 'REENBOLSADA', 'INVALIDA', 'RECHAZADA', 'PERDIDO', 'PARTE-APROBADA')
SOFT_DELETION CONSTRAINT DELETIONS CHECK (SOFT_DELETION IN ('DELETED','ENABLE'))
);



CREATE TABLE BET_AUDITING_TABLE(
ID NUMBER NOT NULL GENERATED ALWAYS AS IDENTITY, PRIMARY KEY,
DATE_TIME TIMESTAMP,
TABLE
RECORD_ID
ACTION
USER_ID NUMBER,
IP varchar2(20),
SOFT_DELETION CONSTRAINT DELETIONS CHECK (SOFT_DELETION IN ('DELETED','ENABLE'))
);


CREATE TABLE DEPOSIT_LIMIT(
ID NUMBER NOT NULL GENERATED ALWAYS AS IDENTITY, PRIMARY KEY,
DAILY_DEPOSIT_LIMIT varchar2(255),
DAILY_DEPOSIT_TIMESTAMP TIMESTAMP,
DAILY_BET_LIMIT varchar2(255),
DAILY_BET_TIMESTAMP TIMESTAMP,
WEEKLY_DEPOSIT_LIMIT varchar2(255),
WEEKLY_DEPOSIT_TIMESTAMP TIMESTAMP,
WEEKLY_BET_LIMIT varchar2(255),
WEEKLY_BET_TIMESTAMP TIMESTAMP,
MONTHLY_DEPOSIT_LIMIT varchar2(255),
MONTHLY_DEPOSIT_TIMESTAMP TIMESTAMP,
MONTHLY_BET_LIMIT varchar2(255),
MONTHLY_BET_TIMESTAMP TIMESTAMP,
SOFT_DELETION CONSTRAINT DELETIONS CHECK (SOFT_DELETION IN ('DELETED','ENABLE'))
);


CREATE TABLE WITHDRAAL(
ID NUMBER NOT NULL GENERATED ALWAYS AS IDENTITY, PRIMARY KEY,
WITHDRAWAL_AMOUNT varchar2(255),
USER_BANK_ACCOUNT_ID NUMBER,
WITHDRAWAL_REQUIREMENTS varchar2(255),
USER_SECURITY_DOCUMENT_ID NUMBER,
TIME_TIMESTAMP TIMESTAMP
STATUS CONSTRAINT CODE_STATE CHECK (STATUS IN ('SIN RETIRAR', 'RETIRADO'))
SOFT_DELETION CONSTRAINT DELETIONS CHECK (SOFT_DELETION IN ('DELETED','ENABLE'))
);

CREATE TABLE USER_BANK_ACCOUNTS(
ID NUMBER NOT NULL GENERATED ALWAYS AS IDENTITY, PRIMARY KEY,
USER_ID NUMBER,
BANK_ID NUMBER,
ACCOUNT_NUMBER  varchar2(255),
SOFT_DELETION CONSTRAINT DELETIONS CHECK (SOFT_DELETION IN ('DELETED','ENABLE'))
);